# Engine: звуковые и системные уведомления таймера

## Назначение
Документ фиксирует реализацию системных уведомлений и помидора (Pomodoro) в таймере, чтобы было понятно, как работает текущий механизм и какие у него ограничения.

## Что происходит при активном таймере
1. Вкладка браузера обновляется:
   - в заголовке показывается время таймера `MM:SS` или `HH:MM:SS` перед названием приложения;
   - на фавиконке рисуется маленькая красная точка.

## Помидор (Pomodoro)
- В нижней панели при активном таймере есть отдельная кнопка с иконкой помидора для быстрого включения/выключения режима и кнопка **«Настройка помидора»**.
- В модальном окне можно:
  - включить/выключить режим;
  - включить/выключить **уведомления** и **звук** для смены фаз;
  - задать длительность **Фокус** и **Отдых** в минутах.
- При включении запускается отдельный обратный отсчёт:
  - фаза **Фокус** → фаза **Отдых** → снова **Фокус**;
  - рядом с основным временем показывается состояние и остаток (`Фокус · MM:SS` / `Отдых · MM:SS`).
- Если Pomodoro включён, обратный отсчёт запускается автоматически при старте таймера или при включении режима во время активного таймера.
- На переходах фаз:
  - отправляются системные уведомления (если разрешены и включены);
  - проигрывается короткий звуковой сигнал (если включён).
- Настройки Pomodoro сохраняются в `localStorage` и применяются автоматически при следующем запуске таймера.

## Как запрашивается разрешение
Разрешение на уведомления запрашивается **только после пользовательского действия**:
- при старте глобального таймера (кнопка Play в нижней панели);
- при старте таймера на карточке цели.

Это сделано, чтобы десктопные браузеры показывали системный prompt корректно.

## Как отправляется системное уведомление
1. При наличии разрешения используется `Service Worker` и `registration.showNotification(...)`.
2. Если Service Worker недоступен, используется fallback `new Notification(...)`.

## Service Worker
Файл `public/sw.js` обрабатывает клики по уведомлению:
- фокусирует уже открытую вкладку приложения;
- при отсутствии вкладки открывает `/`.

## Ограничения и нюансы
- В фоне браузер может **троттлить таймеры**; это ограничение платформы.
- На iOS/Android поведение может отличаться по частоте и стабильности.
- Системные уведомления не придут, если разрешение было отклонено или заблокировано на уровне браузера/OS.
