# Engine: звуковые и системные уведомления таймера

## Назначение
Документ фиксирует реализацию тестовых уведомлений для таймера (звук, баннер, системные уведомления), чтобы было понятно, как работает текущий механизм и какие у него ограничения.

## Что происходит при активном таймере
1. Каждые **30 секунд** планируется событие оповещения.
2. В момент события:
   - показывается локальный баннер в нижней панели;
   - проигрывается короткий звуковой сигнал **~2 секунды**;
   - при выданном разрешении отправляется **системное уведомление**.
3. Вкладка браузера обновляется:
   - в заголовке показывается время таймера `MM:SS` или `HH:MM:SS` перед названием приложения;
   - на фавиконке рисуется маленькая красная точка.
4. Для многовкладочного режима используется **BroadcastChannel** — другие вкладки получают сигнал и показывают баннер.
5. Для защиты от дублей используется `localStorage`‑ключ `minute-alert:last` (триггеры в пределах короткого окна не повторяются).

## Как запрашивается разрешение
Разрешение на уведомления запрашивается **только после пользовательского действия**:
- при старте глобального таймера (кнопка Play в нижней панели);
- при старте таймера на карточке цели.

Это сделано, чтобы десктопные браузеры показывали системный prompt корректно.

## Как отправляется системное уведомление
1. При наличии разрешения используется `Service Worker` и `registration.showNotification(...)`.
2. Если Service Worker недоступен, используется fallback `new Notification(...)`.

## Service Worker
Файл `public/sw.js` обрабатывает клики по уведомлению:
- фокусирует уже открытую вкладку приложения;
- при отсутствии вкладки открывает `/`.

## Ограничения и нюансы
- В фоне браузер может **троттлить таймеры**; это ограничение платформы.
- На iOS/Android поведение может отличаться по частоте и стабильности.
- Системные уведомления не придут, если разрешение было отклонено или заблокировано на уровне браузера/OS.
