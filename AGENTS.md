# AGENTS.md
Инструкции для код-агентов (Copilot/Codex и т.п.) при работе с репозиторием.

Проект: веб-приложение на Next.js (App Router) + TypeScript, бэкенд на Supabase (auth + database), UI на Tailwind CSS, OAuth Google, i18n (ru/en).


## Входная точка в документацию
- README: `README.md`
- Обзор продукта: `docs/overview.md`
- Экраны/UI: `docs/screens.md`
- Доменные правила: `docs/domain-rules.md`
- Модель данных: `docs/data-model.md`
- Разработка и проверки: `docs/dev.md`
- Текущее состояние/статус: `docs/plan.md`

## Supabase
* Миграции: `./supabase/migrations`
* Не меняй схему/политики безопасности (RLS — построчная безопасность) “наугад”.
* Если меняешь поведение, завязанное на базу, обнови документацию в `docs/` и проверь основные сценарии в UI.

## i18n (русский + английский)

Все пользовательские тексты — только через переводы. Хардкод текста в компонентах запрещён.

При добавлении или изменении пользовательских текстов:

1. Добавить ключ в `src/i18n/locales/ru.json`
2. Добавить перевод в `src/i18n/locales/en.json`
3. Обновить `src/i18n/original-texts.md`
4. Использовать в компоненте:

   * `const { t } = useTranslation();`
   * `t("key")`

Переключатель языка: `LanguageSwitcher` (кнопка в шапке EN/RU).
Язык пользователя хранится в `users.language` (Supabase) и восстанавливается при входе.

Структура i18n:

```
src/i18n/
├── config.ts
├── TranslationContext.tsx
├── locales/
│   ├── ru.json
│   └── en.json
└── original-texts.md
```

## UI правила
* Стили только через Tailwind классы.
* Повторяемые элементы выносить в `src/components/`.
* Изменения в UI делай минимальными и локальными, без массовых “улучшений” по всему проекту.

## Правила изменений
* Минимальные, локальные изменения (минимальный diff).
* Не добавлять зависимости без необходимости.
* Не трогать ключи/секреты, не добавлять реальные значения в репозиторий.
* Если меняешь поведение/логику — обнови соответствующую документацию.
* Не делай переименований/рефакторинга “ради красоты”, если это не требуется задачей.


## Процесс выполнения технических задач

При работе с изменением кодовой базы:

1. **Анализ влияния**
   - Изучить изменяемую кодовую базу: понять что меняется, с чем связано, на что может быть эффект
   - Определить затронутые модули и зависимости

2. **Планирование**
   - Составить план работы: что делаем, что проверяем
   - Оценить необходимость изменений в документации

3. **Тестирование**
   - Написать/обновить тесты для новой логики
   - Запустить `make test-all` перед сдачей задачи

4. **Проверка UI**
   - Запустить сайт через MCP Playwright
   - Проверить консоль на ошибки
   - Убедиться в корректной работе функционала

5. **Качество кода**
   - Файлы не должны превышать 600 строк
   - При превышении — логически декомпозировать на модули

6. **Документация**
   - Проверить актуальность существующей документации
   - При необходимости создать новые документы с описанием системы
   - Внести правки в AGENTS.md


## Definition of Done
Задача считается готовой, только если:
* `lint`, `typecheck`, `build`, тесты (включая e2e при наличии изменений в UI/флоу) проходят.
* UI проверен через MCP Playwright, в консоли нет ошибок.
* Все пользовательские тексты заведены через i18n (ru/en) и отражены в `original-texts.md`.
* Документация обновлена, если менялась логика/поведение/данные.


## Структура кода (ключевые места)
- Главная: `app/page.tsx`
- OAuth callback: `app/auth/callback/page.tsx`
- Создание цели: `app/goals/new/page.tsx`
- Детали цели: `app/goals/[id]/page.tsx`
- Статистика: `app/stats/page.tsx`
- Логи времени: `app/time-logs/page.tsx`
- Глобальный таймер: `src/components/GlobalTimerBar.tsx`
- Активный таймер (контекст): `src/components/ActiveTimerProvider.tsx`
- Логика периодов/статусов: `src/components/goalPeriods.ts`
- Supabase client: `lib/supabase/client.ts`
