# План разработки (MVP)

План основан на `docs/schema.dbml`, `docs/user-flows.md` и текущих требованиях.
Каждая фича имеет чекбокс и обязательные инструкции проверки.

---

## Быстрый старт и команды проекта

- Установка: `npm install`
- Запуск dev-сервера: `npm run dev`
- Линтер: `npm run lint`
- Сборка: `npm run build`
- Typecheck: `npm run typecheck` (скрипт нужно добавить в `package.json`)

---

## Статус фич (чекбоксы)

- [x] Фича 0. Каркас приложения (текущая)
- [ ] Фича 1. База данных + Supabase подключение
- [ ] Фича 2. Аутентификация (Google)
- [ ] Фича 3. Создание цели
- [ ] Фича 4. Главный экран (список целей)
- [ ] Фича 5. Базовое логирование с главной
- [ ] Фича 6. Экран цели + ручное добавление
- [ ] Фича 7. Глобальный таймер (без цели)
- [ ] Фича 8. Полировка (после MVP)

---

## [x] Фича 0. Каркас приложения (начинаем с этого)

Цель: получить живую навигацию и пустые экраны для наращивания функционала.

Задачи:
- Роуты (пустые экраны):
  - `/` (главная)
  - `/goals/new` (создание цели)
  - `/goals/[id]` (детали цели)
  - `/stats` (заглушка)
- Layout:
  - шапка: название + Logout (пока заглушка)
  - контейнер с базовой сеткой
  - нижняя панель с глобальной кнопкой Play (пока кнопка)
- Пустые состояния:
  - на `/` — CTA "Добавить цель"

Как проверить:
1) `npm install`
2) `npm run dev`
3) Открыть `http://localhost:3000`
4) Перейти на `/goals/new`, `/goals/1`, `/stats` и убедиться, что страницы рендерятся
5) Проверить наличие шапки, контейнера и нижней панели с кнопкой Play

Проверка через MCP:
- MCP (Playwright): открыть `http://localhost:3000`
- Порт: `3000`
- Учетные данные: не требуются
- При необходимости использовать Context7 для справок по Next.js
- Статус: успешно — проверены `/`, `/goals/new`, `/goals/1`, `/stats`

Автотесты (желательно):
- E2E (Playwright): smoke-тесты маршрутов `/`, `/goals/new`, `/goals/1`, `/stats`
- Запуск: `npm run test:e2e` (после добавления Playwright)

---

## [x] Фича 1. База данных + Supabase подключение

Цель: поднять основу данных и обеспечить изоляцию по пользователю.

Задачи:
- Таблицы (минимум для старта):
  - `users`, `contexts`, `tags`, `goals`, `time_entries`, `counter_events`, `check_events`
- RLS + политики:
  - доступ только к строкам `user_id = auth.uid()`
- Подключение Supabase на фронте (клиент и сервисная часть, если нужна)

Как проверить:
1) Проверить наличие таблиц в Supabase
2) Включить RLS и убедиться, что политика ограничивает доступ по `user_id`
3) Проверить подключение через клиент (например, запрос `select` к `goals`)

Проверка через MCP:
- MCP (Supabase или свой): подключиться к проекту
- Адрес: `NEXT_PUBLIC_SUPABASE_URL`
- Ключ: `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- Учетные данные: через env-переменные, не хардкодить
- Статус: успешно — проверены таблицы (list_tables) и политики RLS (pg_policies)

Автотесты (желательно):
- Unit: тест на клиентский запрос к таблице `goals`
- Запуск: `npm test` (после настройки Vitest)

---

## [x] Фича 2. Аутентификация (Google)

Цель: пользователь может войти и получить `user.id` для привязки данных.

Задачи:
- Google Auth provider в Supabase
- Login / Logout
- Получение текущего пользователя на клиенте
- Upsert в `users` при первом логине (email, name)

Как проверить:
1) Запустить проект
2) Выполнить вход через Google
3) Убедиться, что пользователь отображается как авторизованный
4) Проверить, что запись в `users` создана/обновлена

Проверка через MCP:
- MCP (Playwright): пройти OAuth flow (если доступен в MCP)
- Адрес: `http://localhost:3000`
- Учетные данные: Google-аккаунт (вводится вручную)
- Статус: успешно — выполнен login/logout через Google OAuth

Автотесты (желательно):
- E2E: тест логина/логаута (Playwright)
- Запуск: `npm run test:e2e` (после настройки Playwright)

---

## [ ] Фича 3. Создание цели

Цель: пользователь создает цель через форму.

Задачи:
- `/goals/new`:
  - поля цели (title, type, period, target, dates)
  - выбор/создание контекста на лету
  - теги можно упростить или временно убрать
- Сохранение в `goals` (+ создание `contexts` при необходимости)

Как проверить:
1) Создать цель на `/goals/new`
2) Убедиться, что запись появилась в таблице `goals`
3) Проверить, что контекст создается при новом имени

Проверка через MCP:
- MCP (Playwright): заполнить форму и отправить
- Адрес: `http://localhost:3000/goals/new`
- Учетные данные: авторизованный пользователь

Автотесты (желательно):
- E2E: создание цели и проверка в UI
- Unit: валидаторы формы
- Запуск: `npm test` / `npm run test:e2e`

---

## [ ] Фича 4. Главный экран (список целей)

Цель: видеть активные цели и базовые поля.

Задачи:
- `/`:
  - список целей
  - отображение: title, type, period, target, dates, context
- Empty-state (если целей нет)

Как проверить:
1) Создать 1-2 цели
2) Перейти на `/`
3) Убедиться, что список отображается и поля видны

Проверка через MCP:
- MCP (Playwright): открыть `/` и проверить карточки целей
- Адрес: `http://localhost:3000`
- Учетные данные: авторизованный пользователь

Автотесты (желательно):
- E2E: отображение списка целей
- Запуск: `npm run test:e2e`

---

## [ ] Фича 5. Базовое логирование с главной

Цель: минимальный рабочий MVP-логинг без деталей.

Задачи:
- Для `counter`:
  - кнопка `+1`
  - кнопка `+N` (ввод числа)
- Для `time`:
  - `Play` создает `time_entry` (ended_at = null)
  - `Stop` закрывает текущий `time_entry`

Как проверить:
1) Открыть `/` с целями `counter` и `time`
2) Нажать `+1` и `+N` и проверить записи в `counter_events`
3) Нажать `Play` и `Stop` и проверить записи в `time_entries`

Проверка через MCP:
- MCP (Playwright): нажать кнопки на карточках цели
- Адрес: `http://localhost:3000`
- Учетные данные: авторизованный пользователь

Автотесты (желательно):
- E2E: инкремент счетчика и старт/стоп таймера
- Запуск: `npm run test:e2e`

---

## [ ] Фича 6. Экран цели + ручное добавление

Цель: просмотреть цель и исправить данные, если нужно.

Задачи:
- `/goals/[id]`:
  - шапка цели + прогресс
  - список событий
  - форма ручного добавления:
    - `time`: start/end
    - `counter`: occurred_at + delta

Как проверить:
1) Открыть `/goals/[id]` существующей цели
2) Убедиться, что события отображаются
3) Добавить событие вручную и проверить запись в БД

Проверка через MCP:
- MCP (Playwright): открыть страницу детали и добавить событие
- Адрес: `http://localhost:3000/goals/ID`
- Учетные данные: авторизованный пользователь

Автотесты (желательно):
- E2E: добавление события вручную
- Запуск: `npm run test:e2e`

---

## [ ] Фича 7. Глобальный таймер (без цели)

Цель: ключевой UX — быстрый Play без выбора цели.

Задачи:
- Глобальная кнопка Play:
  - выбор/создание контекста (обязательно)
  - теги/цель — опционально
- Start/Stop `time_entry` без `goal_id`

Как проверить:
1) Нажать глобальный Play
2) Выбрать/создать контекст
3) Старт/стоп таймера
4) Проверить `time_entries` с `goal_id = null`

Проверка через MCP:
- MCP (Playwright): использовать глобальную кнопку Play
- Адрес: `http://localhost:3000`
- Учетные данные: авторизованный пользователь

Автотесты (желательно):
- E2E: глобальный таймер без цели
- Запуск: `npm run test:e2e`

---

## [ ] Фича 8. Полировка (после MVP)

Задачи:
- фильтры на главной (контекст/теги/тип цели)
- `goal_periods` для кэширования статусов
- статистика и графики
- теги для событий (time_entry_tags и т.д.)
- редактирование/удаление событий

Как проверить:
1) Пройти по каждому добавленному улучшению
2) Убедиться, что UI и данные корректны

Проверка через MCP:
- MCP (Playwright): проверить фильтры/статистику/редактирование
- Адрес: `http://localhost:3000`
- Учетные данные: авторизованный пользователь

Автотесты (желательно):
- E2E: фильтры и редактирование
- Unit: расчет прогресса и статусов
- Запуск: `npm test` / `npm run test:e2e`

---

## Документация, которую стоит заполнить позже (не блокирует разработку)

- `docs/domain-rules.md` — правила (позитив/негатив, период, успех/провал)
- `docs/data-model.md` — описание сущностей (по DBML)
- `docs/dev.md` — как запускать/проверять проект
- `docs/roadmap.md` — отложенные идеи

---

## Правило работы с чекбоксами

После выполнения фичи:
1) Проверить фичу через MCP (и при необходимости через Context7/поиск)
2) Поставить `[x]` в чекбоксе соответствующей фичи
3) Зафиксировать, что именно проверялось
